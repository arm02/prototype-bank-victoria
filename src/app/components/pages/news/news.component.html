<div class="investor-trust__news-header">
  <div class="search-box">
    <input
      type="text"
      class="form-control"
      (keyup.enter)="getAllNews('search')"
      [(ngModel)]="query"
      placeholder="Cari Disini ..."
      id="search"
    />
    <button class="btn-primary" (click)="getAllNews('search')">
      <i class="fa fa-search" aria-hidden="true"></i>
    </button>
    <button
      *ngIf="userData.role === 'admin'"
      class="btn-primary btn-download mr-10"
      (click)="downloadNews()"
    >
      Unduh
    </button>
    <button
      *ngIf="userData.role === 'admin' && environment.flag.dialogDeletedNews"
      class="btn-primary btn-add w-full"
      (click)="deletedNewsDialog()"
    >
      Berita Terhapus
    </button>
  </div>
  <div>
    <button (click)="clearFilter()" class="btn-filter mr-10">
      Hapus Filter
    </button>
    <button (click)="createNews()" class="btn-primary btn-add">
      Tambah Data
    </button>
  </div>
</div>
<div class="investor-trust__news-filter">
  <mat-form-field appearance="outline" style="width: 100%">
    <mat-label>Tanggal</mat-label>
    <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
      <input matStartDate formControlName="start" placeholder="Start Date " />
      <input matEndDate formControlName="end" placeholder="End date" />
    </mat-date-range-input>
    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-date-range-picker #picker>
      <mat-date-range-picker-actions>
        <button mat-button matDatepickerCancel>Cancel</button>
        <button
          mat-raised-button
          color="primary"
          (click)="getAllNews()"
          matDatepickerApply
        >
          Apply
        </button>
      </mat-date-range-picker-actions>
    </mat-date-range-picker>

    <mat-error *ngIf="range.controls.start.hasError('matStartDateInvalid')"
      >Invalid start date</mat-error
    >
    <mat-error *ngIf="range.controls.end.hasError('matEndDateInvalid')"
      >Invalid end date</mat-error
    >
  </mat-form-field>
  <mat-form-field appearance="outline" style="width: 100%">
    <mat-label>Editor</mat-label>
    <mat-select [(ngModel)]="writerId" (ngModelChange)="getAllNews()">
      <mat-option>
        <ngx-mat-select-search
          [(ngModel)]="querySearchWriter"
          placeholderLabel="Search Writer by Name ..."
          (ngModelChange)="getAllWriter(querySearchWriter)"
        ></ngx-mat-select-search>
      </mat-option>
      <mat-option>None</mat-option>
      <mat-option *ngFor="let opt of writers" [value]="opt.writer_id">
        {{ opt.name }}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field appearance="outline" style="width: 100%">
    <mat-label>Reporter</mat-label>
    <mat-select [(ngModel)]="reporterId" (ngModelChange)="getAllNews()">
      <mat-option>
        <ngx-mat-select-search
          [(ngModel)]="querySearchWriter"
          placeholderLabel="Search Writer by Name ..."
          (ngModelChange)="getAllWriter(querySearchWriter)"
        ></ngx-mat-select-search>
      </mat-option>
      <mat-option>None</mat-option>
      <mat-option *ngFor="let opt of writers" [value]="opt.writer_id">
        {{ opt.name }}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field appearance="outline" style="width: 100%">
    <mat-label>Situs</mat-label>
    <mat-select [(ngModel)]="siteId" (ngModelChange)="getAllNews()">
      <mat-option>
        <ngx-mat-select-search
          [(ngModel)]="querySearchSite"
          placeholderLabel="Search Site by Name ..."
          (ngModelChange)="getAllSites(querySearchSite)"
        ></ngx-mat-select-search>
      </mat-option>
      <mat-option>None</mat-option>
      <mat-option *ngFor="let opt of sites" [value]="opt.uuid">
        {{ opt.name }}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field appearance="outline" style="width: 100%">
    <mat-label>Kanal</mat-label>
    <mat-select [(ngModel)]="channelId" (ngModelChange)="getAllNews()">
      <mat-option>
        <ngx-mat-select-search
          [(ngModel)]="querySearchChannel"
          placeholderLabel="Search Writer by Name ..."
          (ngModelChange)="getAllChannel(querySearchChannel)"
        ></ngx-mat-select-search>
      </mat-option>
      <mat-option>None</mat-option>
      <mat-option *ngFor="let opt of channels" [value]="opt.page_id">
        {{ opt.pageName }}
      </mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field appearance="outline" style="width: 100%">
    <mat-label>Status</mat-label>
    <mat-select [(ngModel)]="status" (ngModelChange)="getAllNews()">
      <mat-option>None</mat-option>
      <mat-option [value]="'draft'">Draft</mat-option>
      <mat-option [value]="'scheduled'">Scheduled</mat-option>
      <mat-option [value]="'published'">Published</mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field appearance="outline" style="width: 100%">
    <mat-label>Sort By</mat-label>
    <mat-select [(ngModel)]="sortBy.value" (ngModelChange)="getAllNews()">
      <mat-option [value]="'titlePost'">Title</mat-option>
      <mat-option [value]="'page_views'">Page View</mat-option>
      <mat-option [value]="'status'">Status</mat-option>
      <mat-option [value]="'date'">Published At</mat-option>
      <mat-option [value]="'updatedAt'">Updated At</mat-option>
      <mat-option [value]="'createdAt'">Created At</mat-option>
    </mat-select>
  </mat-form-field>
  <mat-form-field appearance="outline" style="width: 100%">
    <mat-label>Sort Type</mat-label>
    <mat-select [(ngModel)]="sortBy.type" (ngModelChange)="getAllNews()">
      <mat-option [value]="'ASC'">A-Z</mat-option>
      <mat-option [value]="'DESC'">Z-A</mat-option>
    </mat-select>
  </mat-form-field>
</div>
<app-table
  [sourceData]="news"
  [rowCount]="rowCount"
  [pageSize]="limit"
  [displayedColumns]="displayedColumns"
  (paginateEvent)="paginateEvent($event)"
  (editEvent)="editNews($event)"
  (deleteEvent)="deleteNews($event)"
  (openLinkEvent)="openLinkNews($event)"
></app-table>
